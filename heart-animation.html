<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magical Heart Shape</title>
    <style>
        :root {
            --bg-color: #050505;
            --btn-bg: rgba(255, 255, 255, 0.05);
            --btn-border: rgba(255, 255, 255, 0.2);
            --btn-text: white;
        }

        [data-theme="light"] {
            --bg-color: #fff5e4;
            --btn-bg: rgba(255, 227, 225, 0.5);
            --btn-border: rgba(230, 115, 115, 0.3);
            --btn-text: #e67373;
        }

        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: var(--bg-color);
            font-family: 'Outfit', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            transition: background-color 0.3s;
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
        }

        .nav-btn {
            position: fixed;
            bottom: 30px;
            width: 50px;
            height: 50px;
            background: var(--btn-bg);
            border: 1px solid var(--btn-border);
            color: var(--btn-text);
            text-decoration: none;
            border-radius: 50%;
            backdrop-filter: blur(15px);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 100;
        }

        .nav-btn::after {
            font-size: 24px;
        }

        .back-btn {
            left: 30px;
        }

        .back-btn::after {
            content: '‚Üê';
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: white;
            transform: scale(1.1) translateX(-5px);
        }

        #theme-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 10px;
            line-height: 1;
            border-radius: 50%;
            border: none;
            background: var(--btn-bg);
            color: var(--btn-text);
            cursor: pointer;
            font-size: 20px;
            z-index: 2000;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s, background-color 0.3s;
            backdrop-filter: blur(10px);
        }

        #theme-toggle:hover {
            transform: scale(1.1);
        }

        @media (max-width: 768px) {
            .nav-btn {
                width: 45px;
                height: 45px;
                bottom: 20px;
            }

            .back-btn {
                left: 20px;
            }

            .nav-btn::after {
                font-size: 20px;
            }

            #theme-toggle {
                top: 15px;
                left: 15px;
                font-size: 18px;
            }
        }

        @media (max-width: 480px) {
            .nav-btn {
                width: 40px;
                height: 40px;
                bottom: 15px;
            }

            .back-btn {
                left: 15px;
            }

            #theme-toggle {
                top: 10px;
                left: 10px;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;600&display=swap" rel="stylesheet">
</head>

<body>
    <canvas id="heartCanvas"></canvas>

    <button id="theme-toggle">üåì</button>
    <a href="flowers-animation.html" class="nav-btn back-btn" title="–î–æ –∫–≤—ñ—Ç—ñ–≤"></a>

    <script>
        const canvas = document.getElementById('heartCanvas');
        const ctx = canvas.getContext('2d');

        let width, height;
        let particles = [];
        const particleCount = 2500;
        let pulseTime = 0;
        let hue = 340;
        let baseScale; // Dynamic scale for responsiveness

        function init() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;

            // Adjust scale based on screen size
            if (width < 480) {
                baseScale = 9; // Small for phones
            } else if (width < 768) {
                baseScale = 12; // Medium for tablets
            } else {
                baseScale = 16; // Original for desktop
            }

            particles = [];
            for (let i = 0; i < particleCount; i++) {
                particles.push(new Particle());
            }
        }

        class Particle {
            constructor() {
                this.reset(true); // Initial reset can be fully random
            }

            reset(initial = false) {
                this.t = Math.random() * Math.PI * 2;
                this.size = Math.random() * 1.2 + 0.5;
                this.life = initial ? Math.random() : 1.0;
                this.deathSpeed = 0.003 + Math.random() * 0.006;

                // Target heart shape coordinates
                this.baseX = 16 * Math.pow(Math.sin(this.t), 3);
                this.baseY = -(13 * Math.cos(this.t) - 5 * Math.cos(2 * this.t) - 2 * Math.cos(3 * this.t) - Math.cos(4 * this.t));

                if (initial) {
                    // Spread particles initially across the screen
                    this.x = Math.random() * width;
                    this.y = Math.random() * height;
                } else {
                    // When resetting, appear slightly closer to the heart to avoid "flying out" mess
                    const dist = 50 + Math.random() * 100;
                    const angle = Math.random() * Math.PI * 2;
                    this.x = width / 2 + this.baseX * baseScale + Math.cos(angle) * dist;
                    this.y = height / 2 + this.baseY * baseScale + Math.sin(angle) * dist;
                }

                this.colorOffset = Math.random() * 40 - 20;
            }

            update() {
                this.life -= this.deathSpeed;
                if (this.life <= 0) {
                    this.reset();
                }

                const pulse = 1 + Math.sin(pulseTime) * 0.12;
                const currentScale = baseScale * pulse;

                const targetX = width / 2 + this.baseX * currentScale;
                const targetY = height / 2 + this.baseY * currentScale;

                // Increased move speed from 0.02 to 0.05 for better shape retention
                this.x += (targetX - this.x) * 0.05;
                this.y += (targetY - this.y) * 0.05;

                const currentHue = (hue + this.colorOffset) % 360;
                this.color = `hsla(${currentHue}, 85%, 65%, ${this.life})`;
            }

            draw() {
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function createSparkle() {
            const t = Math.random() * Math.PI * 2;
            const pulse = 1 + Math.sin(pulseTime) * 0.15;
            const scale = 17 * pulse;
            const x = width / 2 + 16 * Math.pow(Math.sin(t), 3) * scale;
            const y = height / 2 - (13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t)) * scale;

            const sparkle = {
                x: x,
                y: y,
                size: Math.random() * 2 + 2,
                opacity: 1,
                hue: (hue + 20) % 360
            };

            const drawSparkle = () => {
                ctx.fillStyle = `hsla(${sparkle.hue}, 100%, 90%, ${sparkle.opacity})`;
                ctx.beginPath();
                ctx.arc(sparkle.x, sparkle.y, sparkle.size, 0, Math.PI * 2);
                ctx.fill();

                sparkle.opacity -= 0.03;
                if (sparkle.opacity > 0) {
                    requestAnimationFrame(drawSparkle);
                }
            };
            drawSparkle();
        }

        function animate() {
            // Motion blur effect
            ctx.fillStyle = 'rgba(5, 5, 5, 0.12)';
            ctx.fillRect(0, 0, width, height);

            pulseTime += 0.04;
            hue += 0.5; // Slowly cycle colors

            particles.forEach(p => {
                p.update();
                p.draw();
            });

            if (Math.random() > 0.85) {
                createSparkle();
            }

            requestAnimationFrame(animate);
        }

        window.addEventListener('resize', init);

        // Theme switching logic
        const themeToggle = document.getElementById('theme-toggle');
        const currentTheme = localStorage.getItem('theme') || 'dark';

        if (currentTheme === 'light') {
            document.documentElement.setAttribute('data-theme', 'light');
        }

        themeToggle.addEventListener('click', () => {
            let theme = document.documentElement.getAttribute('data-theme');
            if (theme === 'light') {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
                localStorage.setItem('theme', 'light');
            }
        });

        init();
        animate();
    </script>
</body>

</html>